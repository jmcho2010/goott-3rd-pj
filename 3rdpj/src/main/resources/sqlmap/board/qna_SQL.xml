<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="qna">

    <insert id="insert">
        insert into qna(user_id, qna_title, qna_content, qna_pw)
        values (#{user_id}, #{qna_title}, #{qna_content}, #{qna_pw})
    </insert>

    <select id="list" resultType="com.goott.pj3.board.qna.dto.QnaDTO">
        select qna_idx, qna_title, qna_content, user_id, create_date, category, qna_pw
        from qna
        where
        <choose>
            <when test="category eq 'N'.toString()">
                category = #{category}
            </when>
            <when test="category eq 'U'.toString()">
                category = #{category}
            </when>
            <when test="category eq 'R'.toString()">
                category = #{category}
            </when>
            <when test="category eq 'E'.toString()">
                category = #{category}
            </when>
        </choose>
        and q_del_yn = 'n'
        and
        <if test="option == 'user_id'"> user_id like CONCAT('%',#{keyword},'%')</if>
        <if test="option == 'title'"> qna_title like CONCAT('%',#{keyword},'%')</if>
        <if test="option == 'content'"> qna_content like CONCAT('%',#{keyword},'%')</if>
        <if test="option == 'title,content'"> qna_title like CONCAT('%',#{keyword},'%')
            or qna_content like CONCAT('%',#{keyword},'%')</if>
        <if test="option == null or option == ''">1=1</if>
        order by qna_idx desc
        limit #{pageStart}, #{perPageNum}
    </select>

    <select id="totalCount" resultType="int">
        select count(qna_idx)
        from qna
        where
        <choose>
            <when test="category eq 'N'.toString()">
                category = #{category}
            </when>
            <when test="category eq 'U'.toString()">
                category = #{category}
            </when>
            <when test="category eq 'R'.toString()">
                category = #{category}
            </when>
            <when test="category eq 'E'.toString()">
                category = #{category}
            </when>
        </choose>
        and q_del_yn = 'n'
        and
        <if test="option == 'user_id'"> user_id like CONCAT('%',#{keyword},'%')</if>
        <if test="option == 'title'"> qna_title like CONCAT('%',#{keyword},'%')</if>
        <if test="option == 'content'"> qna_content like CONCAT('%',#{keyword},'%')</if>
        <if test="option == 'title,content'"> qna_title like CONCAT('%',#{keyword},'%')
            or qna_content like CONCAT('%',#{keyword},'%')</if>
        <if test="option == null or option == ''">1=1</if>
    </select>

    <select id="detail" resultType="com.goott.pj3.board.qna.dto.QnaDTO">
        select qna_idx, qna_title, qna_content, create_date, category
        from qna
        where qna_idx = #{qna_idx}
    </select>

    <select id="list_n" resultType="com.goott.pj3.board.qna.dto.QnaDTO">
        <![CDATA[
        select qna_idx, qna_title
        from qna
        where q_del_yn = 'n'
          and category = 'N'
        order by qna_idx DESC
        ]]>
    </select>

    <select id="list_u" resultType="com.goott.pj3.board.qna.dto.QnaDTO">
        <![CDATA[
        select qna_idx, qna_title
        from qna
        where q_del_yn = 'n'
          and category = 'U'
        order by qna_idx DESC
        ]]>
    </select>

    <select id="list_r" resultType="com.goott.pj3.board.qna.dto.QnaDTO">
        <![CDATA[
        select qna_idx, qna_title
        from qna
        where q_del_yn = 'n'
          and category = 'R'
        order by qna_idx DESC
        ]]>
    </select>

    <select id="list_e" resultType="com.goott.pj3.board.qna.dto.QnaDTO">
        <![CDATA[
        select qna_idx, qna_title
        from qna
        where q_del_yn = 'n'
          and category = 'E'
        order by qna_idx DESC
        ]]>
    </select>

    <update id="modify">
        update qna
        set qna_title = #{qna_title}, qna_content = #{qna_content}
        where qna_idx = #{qna_idx}
    </update>

    <update id="delete">
        update qna
        set q_del_yn = 'y'
        where qna_idx = #{qna_idx}
    </update>

    <select id="get_category" resultType="String">
        select category
        from qna
        where qna_idx = #{qna_idx}
    </select>
</mapper>